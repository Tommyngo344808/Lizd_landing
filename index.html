
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LIZD ‚Äî ChƒÉn Ga G·ªëi M√°t L·∫°nh</title>
  <style>
    :root { --primary:#1e90ff; --accent:#ff7a00; --text:#0f172a; --muted:#64748b; --border:#e2e8f0; --radius:14px; --shadow:0 10px 25px rgba(2,6,23,.06); }
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:#fff}
    .container{width:min(1100px,92vw);margin-inline:auto}
    .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.7rem 1rem;border-radius:999px;border:1px solid var(--primary);background:var(--primary);color:#fff;cursor:pointer}
    .btn.secondary{background:#fff;color:var(--primary)}
    header.hero{background:linear-gradient(135deg,#ff7a00,#ffb703);color:#0b1320;padding:64px 0 48px}
    .badge{display:inline-block;background:#fff;color:#ff7a00;padding:.25rem .5rem;border-radius:999px;font-weight:700;font-size:.85rem}
    h1{font-size:clamp(28px,5vw,54px);margin:8px 0 6px}
    .subtitle{opacity:.85;font-size:clamp(14px,2.2vw,18px)}
    .hero-actions{margin-top:22px;display:flex;gap:12px;flex-wrap:wrap}
    .section{padding:36px 0}
    .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:18px}
    .card{background:#fff;border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
    .cover-wrap{width:100%;aspect-ratio:4/3;position:relative;overflow:hidden;background:#f6f7f8}
    .cover-scroll{display:flex;height:100%;width:100%;overflow-x:auto;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;scroll-behavior:smooth}
    .cover-scroll::-webkit-scrollbar{display:none}
    .cover-item{flex:0 0 100%;height:100%;scroll-snap-align:center;display:grid;place-items:center}
    .cover-item img{width:100%;height:100%;object-fit:cover}
    .badge-off{position:absolute;top:8px;right:8px;background:#ffe08a;color:#b45309;font-weight:800;padding:.25rem .5rem;border-radius:8px;font-size:.8rem;box-shadow:0 4px 10px rgba(0,0,0,.08)}
    .card .body{padding:14px}
    .title{font-weight:700;line-height:1.3}
    .price{color:#ef4444;font-weight:800;margin-top:10px}
    .listp{color:#94a3b8;text-decoration:line-through;margin-left:6px}
    footer.site{padding:26px 0;border-top:1px solid var(--border);color:var(--muted)}
    dialog.modal{border:none;border-radius:16px;width:min(960px,96vw);box-shadow:var(--shadow)}
    dialog::backdrop{background:rgba(2,6,23,.55)}
    .pm-hero{position:relative;aspect-ratio:4/3;background:#f6f7f8;border-radius:12px;overflow:hidden}
    .pm-slide{position:absolute;inset:0;background:#f6f7f8 center/cover no-repeat;opacity:0;transition:opacity .25s ease}
    .pm-slide.active{opacity:1}
    .pm-nav{position:absolute;top:50%;transform:translateY(-50%);background:#0008;color:#fff;border:none;border-radius:999px;width:36px;height:36px;display:grid;place-items:center;cursor:pointer}
    .pm-prev{left:8px}.pm-next{right:8px}.pm-dots{position:absolute;left:0;right:0;bottom:8px;display:flex;justify-content:center;gap:6px}
    .pm-dot{width:8px;height:8px;border-radius:999px;background:#fff9;border:1px solid #fff}.pm-dot.active{background:#fff}
    .pm-prices{display:flex;gap:.5rem;align-items:center;margin:.5rem 0 1rem;flex-wrap:wrap}
    .pm-list{color:#94a3b8;text-decoration:line-through}.pm-price,.pm-range{color:#ef4444;font-weight:700}
    .pm-variants{display:flex;gap:8px;flex-wrap:wrap}.pm-tag{background:#f1f5f9;border:1px solid #e2e8f0;padding:.25rem .5rem;border-radius:999px;font-size:.85rem}
    .pm-order{background:#f8fafc;border:1px solid #e2e8f0;padding:12px;border-radius:12px;margin-top:12px}
    .pm-order .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    @media (max-width:760px){.pm-order .row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header class="hero">
    <div class="container">
      <span class="badge">üî• FLASH SALE</span>
      <h1>N·ªî ƒê·ªòI GI√Å</h1>
      <div class="subtitle">ChƒÉn Ga G·ªëi Cao C·∫•p ‚Äì Gi·∫£m ƒê·∫øn 50%</div>
      <div class="hero-actions">
        <a href="#sanpham" class="btn">üõçÔ∏è Xem s·∫£n ph·∫©m</a>
        <a target="_blank" rel="noopener" class="btn secondary" href="https://shopee.vn/lizdnamat">üõí Mua tr√™n Shopee</a>
      </div>
    </div>
  </header>

  <main class="section container" id="sanpham">
    <h2 style="margin:0 0 12px">S·∫£n ph·∫©m n·ªïi b·∫≠t</h2>
    <p id="loadNote" class="subtitle" style="font-size:.95rem;color:#64748b;margin:0 0 16px">ƒêang t·∫£i s·∫£n ph·∫©m t·ª´ <code>products_grouped.json</code>‚Ä¶</p>
    <div id="productGrid" class="products"></div>
  </main>

  <footer class="site">
    <div class="container">
      <div>‚òé Li√™n h·ªá: <strong>0949 090 033</strong> ‚Ä¢ <strong>0912 274 788</strong> ‚Ä¢ <strong>0969 724 994</strong> ‚Ä¢ <strong>0962 004 680</strong></div>
      <div>Zalo: 0949 090 033 ‚Ä¢ Shopee: <a href="https://shopee.vn/lizdnamat" target="_blank" rel="noopener">shopee.vn/lizdnamat</a></div>
      <div style="margin-top:6px">¬© 2025 LIZD Bedding</div>
    </div>
  </footer>

  <dialog id="productModal" class="modal">
    <article>
      <header style="display:flex;align-items:center;justify-content:space-between">
        <h3 id="pmTitle" style="margin:0">Chi ti·∫øt s·∫£n ph·∫©m</h3>
        <button onclick="document.getElementById('productModal').close()" class="btn secondary">ƒê√≥ng</button>
      </header>
      <div class="grid" style="gap:16px;margin-top:12px">
        <div class="col-12" style="grid-column:span 6">
          <div class="pm-hero">
            <div id="pmSlides"></div>
            <button class="pm-nav pm-prev" id="pmPrev" aria-label="Prev">‚Äπ</button>
            <button class="pm-nav pm-next" id="pmNext" aria-label="Next">‚Ä∫</button>
            <div class="pm-dots" id="pmDots"></div>
          </div>
        </div>
        <div class="col-12" style="grid-column:span 6">
          <p id="pmDesc" class="muted"></p>
          <div class="pm-prices">
            <span id="pmList" class="pm-list"></span>
            <span id="pmPrice" class="pm-price"></span>
            <span id="pmRange" class="pm-range"></span>
          </div>
          <div class="pm-variants">
            <div class="row">
              <select id="selSize"><option value="">* K√≠ch th∆∞·ªõc --- Ch·ªçn ---</option></select>
              <select id="selColor"><option value="">* M√†u s·∫Øc --- Ch·ªçn ---</option></select>
            </div>
          </div>
          <div class="pm-order">
            <strong>ƒê·∫∑t nhanh</strong>
            <div class="row" style="margin-top:8px">
              <input id="ordName" placeholder="T√™n c·ªßa b·∫°n" />
              <input id="ordPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i" />
            </div>
            <div class="row">
              <select id="ordVariant"><option value="">Ch·ªçn bi·∫øn th·ªÉ (n·∫øu c√≥)</option></select>
              <input id="ordNote" placeholder="Ghi ch√∫ (m√†u, ƒë·ªãa ch·ªâ, gi·ªù giao‚Ä¶)" />
            </div>
            <div class="row" style="margin-top:8px">
              <select id="zaloPhone">
                <option value="0949090033">Zalo: 0949 090 033</option>
                <option value="0912274788">Zalo: 0912 274 788</option>
                <option value="0969724994">Zalo: 0969 724 994</option>
                <option value="0962004680">Zalo: 0962 004 680</option>
              </select>
              <button class="btn" id="btnQuickOrder">G·ª≠i Zalo</button>
            </div>
            <div class="row">
              <a class="btn" id="btnCall" href="tel:0949090033">G·ªçi ngay</a>
              <a class="btn secondary" id="pmLink" href="#" target="_blank" rel="noopener">Xem tr√™n trang g·ªëc</a>
            </div>
          </div>
        </div>
      </div>
    </article>
  </dialog>

  <script>
    const PLACEHOLDER_SRC = "data:image/svg+xml;utf8," + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600"><rect width="100%" height="100%" fill="#f0f3f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="20" fill="#94a3b8">No image</text></svg>');
    const grid = document.getElementById('productGrid');
    const vnd = n => (n||0)? n.toLocaleString('vi-VN') + ' ƒë' : '';
    const PRICE_CAP = 5e7;

    function normalize(p){
      const imgs = Array.isArray(p.image_urls) ? p.image_urls : (p.image_url? [p.image_url] : []);
      return {
        name: p.name||'',
        desc: p.desc||'',
        url: p.url||'',
        image_urls: imgs,
        image_url: p.image_url||'',
        list_price: p.list_price||0,
        price_min: p.price_min||0,
        price_max: p.price_max||0,
        price: p.price_min || p.list_price || 0,
        variants: Array.isArray(p.variants)? p.variants : []
      };
    }

    function priceHtml(p){
      const hasRange = p.price_min && p.price_max && p.price_max !== p.price_min;
      const single = p.price || p.price_min || 0;
      const isAbnormal = (single && single > PRICE_CAP) || (p.price_max && p.price_max > PRICE_CAP);
      if (isAbnormal) return '<span class="price">Li√™n h·ªá</span>';
      if (hasRange) return '<span class="price">'+vnd(p.price_min)+' ‚Äì '+vnd(p.price_max)+'</span>';
      const lp = (p.list_price && p.list_price > single && p.list_price < PRICE_CAP) ? '<span class="listp">'+vnd(p.list_price)+'</span>' : '';
      return '<span class="price">'+vnd(single)+'</span> ' + lp;
    }

    function imgTag(p){
      const urls = (p.image_urls&&p.image_urls.length?p.image_urls: (p.image_url?[p.image_url]:[]));
      const inner = (urls.length?urls:[PLACEHOLDER_SRC]).map(u => '<div class="cover-item"><img src="'+(u||PLACEHOLDER_SRC)+'" onerror="this.onerror=null;this.src=\\''+PLACEHOLDER_SRC+'\\'" /></div>').join('');
      const priceBase = (p.price || p.price_min || 0), listp=(p.list_price||0);
      let off=''; if(listp && priceBase && listp>priceBase){ const pct=Math.round((1-priceBase/listp)*100); if(pct>0) off='<div class="badge-off">'+pct+'% GI·∫¢M</div>'; }
      return '<div class="cover-wrap"><div class="cover-scroll">'+inner+'</div>'+off+'</div>';
    }

    function cardTemplate(p, idx){
      return '<div class="card" data-idx="'+idx+'">'+
          imgTag(p)+
          '<div class="body">'+
            '<div class="title"><a href="javascript:void(0)" class="open-detail">'+(p.name||'')+'</a></div>'+
            '<div>'+priceHtml(p)+'</div>'+
            '<div style="margin-top:10px"><button class="btn open-detail">Xem chi ti·∫øt</button></div>'+
          '</div>'+
        '</div>';
    }

    function renderProducts(data){
      const arr = data.map(normalize);
      grid.innerHTML = arr.map(cardTemplate).join('');
      grid.querySelectorAll('.card .open-detail, .card .cover-wrap').forEach(el => {
        el.addEventListener('click', e => {
          const card = e.currentTarget.closest('.card');
          openDetail(arr[+card.dataset.idx]);
        });
      });
      document.getElementById('loadNote').textContent = 'ƒê√£ t·∫£i ' + arr.length + ' s·∫£n ph·∫©m.';
    }

    // Modal logic
    let currentIndex = 0, currentProd = null;
    function setSlides(urls){
      const box = document.getElementById('pmSlides');
      const dots = document.getElementById('pmDots');
      box.innerHTML = ''; dots.innerHTML='';
      (urls||[]).forEach((u,i)=>{
        const d=document.createElement('div'); d.className='pm-slide'+(i===0?' active':''); d.style.backgroundImage = u ? `url('${u}')` : ''; box.appendChild(d);
        const dot=document.createElement('div'); dot.className='pm-dot'+(i===0?' active':''); dot.addEventListener('click', ()=>goTo(i)); dots.appendChild(dot);
      });
      currentIndex = 0;
    }
    function goTo(i){
      const slides=[...document.querySelectorAll('.pm-slide')], dots=[...document.querySelectorAll('.pm-dot')];
      if(!slides.length) return; i=(i+slides.length)%slides.length;
      slides.forEach((s,idx)=>s.classList.toggle('active', idx===i));
      dots.forEach((d,idx)=>d.classList.toggle('active', idx===i));
      currentIndex=i;
    }
    document.getElementById('pmPrev').addEventListener('click',()=>goTo(currentIndex-1));
    document.getElementById('pmNext').addEventListener('click',()=>goTo(currentIndex+1));

    function buildVariantMaps(p){
      const map = new Map();
      (p.variants||[]).forEach(v=>{
        const label = (v.label||'')+''; const parts=label.split('/').map(s=>s.trim());
        const size = parts[0] || (v.attrs && v.attrs.size) || ''; const color = parts[1] || '';
        const price = Number(v.price||0);
        if (!map.has(size)) map.set(size, {price:price, colors:new Set()});
        const obj = map.get(size); if(price && !obj.price) obj.price = price; if(color) obj.colors.add(color);
      });
      return map;
    }
    function fillSizeAndColor(map){
      const sizeSel=document.getElementById('selSize'), colorSel=document.getElementById('selColor');
      sizeSel.innerHTML='<option value="">* K√≠ch th∆∞·ªõc --- Ch·ªçn ---</option>';
      for(const size of map.keys()){ sizeSel.innerHTML += '<option value="'+size+'">'+size+'</option>'; }
      colorSel.innerHTML='<option value="">* M√†u s·∫Øc --- Ch·ªçn ---</option>';
      sizeSel.addEventListener('change', ()=>{
        const s=sizeSel.value, info=map.get(s); colorSel.innerHTML='<option value="">* M√†u s·∫Øc --- Ch·ªçn ---</option>';
        if(info){ info.colors.forEach(c=> colorSel.innerHTML += '<option value="'+c+'">'+c+'</option>');
          if(info.price){ document.getElementById('pmList').textContent=''; document.getElementById('pmRange').textContent=''; document.getElementById('pmPrice').textContent=vnd(info.price); }
        }
      });
    }

    function openDetail(p){
      currentProd = p;
      document.getElementById('pmTitle').textContent = p.name||'Chi ti·∫øt s·∫£n ph·∫©m';
      const pics = (Array.isArray(p.image_urls)&&p.image_urls.length)?p.image_urls:(p.image_url?[p.image_url]:[]);
      setSlides(pics);
      document.getElementById('pmDesc').textContent = p.desc||'';
      const hasRange=p.price_min&&p.price_max&&p.price_max!==p.price_min;
      const single=p.price||p.price_min||0;
      const isAbnormal=(single&&single>PRICE_CAP)||(p.price_max&&p.price_max>PRICE_CAP);
      const listEl=document.getElementById('pmList'), priceEl=document.getElementById('pmPrice'), rangeEl=document.getElementById('pmRange');
      listEl.textContent=''; priceEl.textContent=''; rangeEl.textContent='';
      if(isAbnormal){ priceEl.textContent='Li√™n h·ªá'; }
      else if(hasRange){ rangeEl.textContent=vnd(p.price_min)+' ‚Äì '+vnd(p.price_max); }
      else { priceEl.textContent=vnd(single); if(p.list_price&&p.list_price>single&&p.list_price<PRICE_CAP) listEl.textContent=vnd(p.list_price); }

      const sel=document.getElementById('ordVariant'), sizeSel=document.getElementById('selSize'), colorSel=document.getElementById('selColor');
      sel.innerHTML='<option value="">Ch·ªçn bi·∫øn th·ªÉ (n·∫øu c√≥)</option>'; sizeSel.innerHTML='<option value="">* K√≠ch th∆∞·ªõc --- Ch·ªçn ---</option>'; colorSel.innerHTML='<option value="">* M√†u s·∫Øc --- Ch·ªçn ---</option>';
      if(Array.isArray(p.variants)&&p.variants.length){ const map=buildVariantMaps(p); fillSizeAndColor(map); }
      const link=document.getElementById('pmLink'); if(p.url){link.href=p.url;link.style.display='inline-flex';} else link.style.display='none';
      const zsel=document.getElementById('zaloPhone'); if(zsel) zsel.selectedIndex=0; const callBtn=document.getElementById('btnCall'); if(callBtn) callBtn.href='tel:'+(zsel?zsel.value:'0949090033');
      document.getElementById('productModal').showModal();
    }

    document.getElementById('btnQuickOrder').addEventListener('click', ()=>{
      const name=document.getElementById('ordName').value.trim();
      const phone=document.getElementById('ordPhone').value.trim();
      const selSize=document.getElementById('selSize').value;
      const selColor=document.getElementById('selColor').value;
      const note=document.getElementById('ordNote').value.trim();
      const p=currentProd||{}; const single=p.price||p.price_min||0; const priceText=(p.price_min&&p.price_max)?(vnd(p.price_min)+' ‚Äì '+vnd(p.price_max)):(single&&single<PRICE_CAP?vnd(single):'Li√™n h·ªá');
      const line=['ƒê·∫∂T H√ÄNG NHANH','S·∫£n ph·∫©m: '+(p.name||''), selSize?('K√≠ch th∆∞·ªõc: '+selSize):'', selColor?('M√†u: '+selColor):'', 'Gi√°: '+priceText, name?('Kh√°ch: '+name):'', phone?('SƒêT: '+phone):'', note?('Ghi ch√∫: '+note):''].filter(Boolean).join('\\n');
      const zaloPhone=(document.getElementById('zaloPhone')?.value||'0949090033'); const url='https://zalo.me/'+zaloPhone+'?text='+encodeURIComponent(line); const callBtn=document.getElementById('btnCall'); if(callBtn) callBtn.href='tel:'+zaloPhone; window.open(url,'_blank','noopener');
    });


    async function loadProductsFrom(path){
      try{
        const r = await fetch(path,{cache:'no-store'});
        if(!r.ok) throw new Error('HTTP '+r.status);
        const obj = await r.json();
        const arr = Array.isArray(obj) ? obj : (obj.data || []);
        if (!Array.isArray(arr) || !arr.length) throw new Error('Empty array in '+path);
        console.log('[Products] Loaded', arr.length, 'items from', path);
        return arr;
      }catch(e){
        console.warn('[Products] Failed to load from', path, e);
        return null;
      }
    }

    (async () => {
      let arr = await loadProductsFrom('products_grouped.json');
      if (!arr) arr = await loadProductsFrom('site_data/products_grouped.json');
      if (!arr){
        document.getElementById('loadNote').textContent =
          'Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu s·∫£n ph·∫©m. H√£y ƒë·∫∑t file products_grouped.json ·ªü root (ho·∫∑c site_data/products_grouped.json).';
        return;
      }
      renderProducts(arr);
    })();

  </script>
</body>
</html>
