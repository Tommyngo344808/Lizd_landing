<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sản phẩm Tháng 8 - NaMat LIZD</title>
  <meta name="description" content="Tổng hợp sản phẩm Tháng 8 NaMat LIZD - giá tốt, nhiều ưu đãi." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Ẩn mô tả ở thẻ card để gọn layout */
    #grid .card .desc,
    #grid .card p.text-sm,
    #grid .card .product-desc { display: none !important; }
    /* Khi mở modal: khoá scroll nền (được bật bằng class .modal-open trên <body>) */
    body.modal-open { overflow: hidden; }
  </style>
</head>
<body class="bg-gray-50">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <h1 class="text-xl font-bold">SẢN PHẨM THÁNG 8</h1>
      <div class="ml-auto flex gap-2">
        <input id="search" type="search" placeholder="Tìm sản phẩm..." class="px-3 py-2 border rounded-lg w-64">
        <select id="sort" class="px-3 py-2 border rounded-lg">
          <option value="relevance">Sắp xếp: Phù hợp</option>
          <option value="priceAsc">Giá tăng dần</option>
          <option value="priceDesc">Giá giảm dần</option>
          <option value="discountDesc">Giảm giá nhiều</option>
        </select>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-6xl mx-auto px-4 py-6">
    <div id="stats" class="mb-4 text-sm text-gray-600"></div>
    <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-5"></div>
  </main>

  <!-- Modal -->
  <div id="product-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50" data-close="1" aria-hidden="true"></div>
    <div class="absolute inset-x-0 top-10 mx-auto w-[min(900px,92%)] bg-white rounded-2xl shadow-xl overflow-hidden">
      <div class="flex items-start justify-between p-4 border-b">
        <h3 id="m-title" class="text-lg font-semibold"></h3>
        <button class="p-2 hover:bg-gray-100 rounded-lg" data-close="1" aria-label="Đóng">✕</button>
      </div>
      <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="aspect-[4/3] bg-gray-100 rounded-xl overflow-hidden">
          <img id="m-img" src="" alt="" class="w-full h-full object-cover" loading="lazy">
        </div>
        <div>
          <div class="flex items-baseline gap-2">
            <span id="m-price" class="text-2xl font-bold text-emerald-700"></span>
            <span id="m-list" class="text-sm line-through text-gray-400"></span>
          </div>
          <p id="m-desc" class="mt-3 text-sm text-gray-700 leading-relaxed"></p>
          <div class="mt-4 flex gap-2">
            <a id="m-link" href="#" target="_blank"
               class="inline-flex items-center justify-center px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-medium">
              Mua ngay
            </a>
            <button class="px-4 py-2 rounded-xl border text-sm" data-close="1">Đóng</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="py-10 text-center text-sm text-gray-500">© NaMat LIZD</footer>

<script>
(async function() {
  // ---- Config: đổi đường dẫn sang 'products_grouped.json' nếu bạn dùng file đã gom biến thể
  const DATA_FILE = 'products.json';

  // ---- Load data
  const res = await fetch(DATA_FILE);
  let payload = await res.json();
  // hỗ trợ cả {data:[...]} hoặc mảng []
  const items = (Array.isArray(payload) ? payload : payload.data) || [];

  // ---- State & elements
  let query = '';
  let sort = 'relevance';

  const grid  = document.getElementById('grid');
  const stats = document.getElementById('stats');
  const search = document.getElementById('search');
  const sortSel = document.getElementById('sort');

  const modal = document.getElementById('product-modal');
  const mTitle = document.getElementById('m-title');
  const mImg   = document.getElementById('m-img');
  const mDesc  = document.getElementById('m-desc');
  const mPrice = document.getElementById('m-price');
  const mList  = document.getElementById('m-list');
  const mLink  = document.getElementById('m-link');

  function fmtVND(n) { return (n && n > 0) ? (n.toLocaleString('vi-VN') + ' ₫') : 'Liên hệ'; }
  function normalizeNoDia(s='') { return s.toLowerCase().normalize('NFD').replace(/\p{Diacritic}+/gu,''); }

  function getDisplayPrice(p) {
    // ưu tiên display_* nếu đã có; nếu dữ liệu gom biến thể: dùng price_min/price_max
    if (p.display_price) return p.display_price;
    const base = p.price ?? p.price_min ?? 0;
    const max  = p.price_max ?? base;
    return (max && max !== base) ? `${fmtVND(base)} - ${fmtVND(max)}` : fmtVND(base);
  }
  function getDisplayList(p) {
    if (p.display_list_price) return p.display_list_price;
    const list = p.list_price ?? 0;
    if (!list) return '';
    const base = p.price ?? p.price_min ?? 0;
    return list > base ? fmtVND(list) : '';
  }

  function cardTemplate(p, idx) {
    const price = getDisplayPrice(p);
    const list  = getDisplayList(p);
    const badge = p.discount_pct ? `<span class="ml-auto text-xs bg-rose-50 text-rose-600 px-2 py-1 rounded-full">-${p.discount_pct}%</span>` : '';
    return `
      <div class="card bg-white rounded-2xl overflow-hidden shadow hover:shadow-lg transition cursor-pointer" data-idx="${idx}">
        <div class="aspect-[4/3] bg-gray-100 overflow-hidden">
          <img src="${p.image_url||''}" alt="${p.name||''}" class="w-full h-full object-cover" loading="lazy">
        </div>
        <div class="p-4">
          <h3 class="font-semibold leading-snug line-clamp-2 min-h-[3rem]">${p.name||''}</h3>
          <div class="mt-2 flex items-baseline gap-2">
            <span class="text-lg font-bold text-emerald-700">${price}</span>
            ${list ? `<span class="text-sm line-through text-gray-400">${list}</span>` : ''}
            ${badge}
          </div>
          <!-- Không hiển thị mô tả ở card -->
        </div>
      </div>
    `;
  }

  function render(list) {
    stats.textContent = `Hiển thị ${list.length} / ${items.length} sản phẩm`;
    grid.innerHTML = list.map((p, i) => cardTemplate(p, i)).join('');
  }

  function apply() {
    const nq = normalizeNoDia(query);
    let list = items.filter(p => normalizeNoDia(p.name||'').includes(nq));
    switch (sort) {
      case 'priceAsc':
        list = list.slice().sort((a,b)=>
          (a.price ?? a.price_min ?? 1e15) - (b.price ?? b.price_min ?? 1e15)
        ); break;
      case 'priceDesc':
        list = list.slice().sort((a,b)=>
          (b.price ?? b.price_min ?? 0) - (a.price ?? a.price_min ?? 0)
        ); break;
      case 'discountDesc':
        list = list.slice().sort((a,b)=>(b.discount_pct||0)-(a.discount_pct||0)); break;
    }
    render(list);
  }

  // ----- Modal handlers
  function openModal(p) {
    document.body.classList.add('modal-open');
    mTitle.textContent = p.name || '';
    mImg.src = p.image_url || '';
    mImg.alt = p.name || '';
    mDesc.textContent = p.desc || '';
    const base = p.price ?? p.price_min ?? 0;
    const max  = p.price_max ?? base;
    mPrice.textContent = (max && max !== base) ? `${fmtVND(base)} - ${fmtVND(max)}` : fmtVND(base);
    const list = p.list_price ?? 0;
    mList.textContent = (list && list > base) ? fmtVND(list) : '';
    mLink.href = p.url || '#';
    modal.classList.remove('hidden');
  }
  function closeModal() {
    modal.classList.add('hidden');
    document.body.classList.remove('modal-open');
  }

  // events
  search.addEventListener('input', e => { query = e.target.value; apply(); });
  sortSel.addEventListener('change', e => { sort = e.target.value; apply(); });
  grid.addEventListener('click', e => {
    const card = e.target.closest('.card');
    if (!card) return;
    const idx = +card.getAttribute('data-idx');
    const p = items[idx];
    if (p) openModal(p);
  });
  modal.addEventListener('click', e => { if (e.target.dataset.close) closeModal(); });

  apply();
})();
</script>
</body>
</html>
